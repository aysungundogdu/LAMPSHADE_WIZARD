<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lampshade Wizard - Pro</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        .signature-line {
            background: linear-gradient(90deg, rgba(79, 70, 229, 0) 0%, rgba(79, 70, 229, 0.1) 50%, rgba(79, 70, 229, 0) 100%);
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen flex flex-col antialiased">
    <div id="root" class="flex-grow"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const translations = {
            en: {
                title: "LAMPSHADE WIZARD",
                subtitle: "Perfect patterns, magical results",
                bottomD: "BOTTOM DIAMETER",
                topD: "TOP DIAMETER",
                height: "HEIGHT",
                seam: "SEAM ALLOWANCE",
                results: "Magical Results",
                slant: "SLANT HEIGHT",
                angle: "PATTERN ANGLE",
                exportSvg: "Export SVG",
                exportDxf: "Export DXF (CAD)",
                preview: "Preview updates automatically",
                body: "BODY",
                seamTag: "SEAM",
                preparedBy: "Developed by Aysun",
                description: "Professional cone expansion tool"
            },
            tr: {
                title: "ABAJUR SÄ°HÄ°RBAZI",
                subtitle: "Kusursuz kalÄ±plar, sihirli sonuÃ§lar",
                bottomD: "ALT Ã‡AP (dB)",
                topD: "ÃœST Ã‡AP (dT)",
                height: "YÃœKSEKLÄ°K (h)",
                seam: "DÄ°KÄ°Åž PAYI",
                results: "Sihirli SonuÃ§lar",
                slant: "YAN KENAR",
                angle: "AÃ‡ILIM AÃ‡ISI",
                exportSvg: "SVG Ä°ndir",
                exportDxf: "DXF (CAD) Ä°ndir",
                preview: "Ã–nizleme otomatik gÃ¼ncellenir",
                body: "GÃ–VDE",
                seamTag: "PAY",
                preparedBy: "Aysun tarafÄ±ndan hazÄ±rlanmÄ±ÅŸtÄ±r",
                description: "Profesyonel koni aÃ§Ä±lÄ±m aracÄ±"
            },
            es: {
                title: "MAGO DE PANTALLAS",
                subtitle: "Patrones perfectos, resultados mÃ¡gicos",
                bottomD: "DIÃMETRO INFERIOR",
                topD: "DIÃMETRO SUPERIOR",
                height: "ALTURA",
                seam: "MARGEN DE COSTURA",
                results: "Resultados MÃ¡gicos",
                slant: "ALTURA INCLINADA",
                angle: "ÃNGULO DEL PATRÃ“N",
                exportSvg: "Exportar SVG",
                exportDxf: "Exportar DXF (CAD)",
                preview: "La vista previa se actualiza sola",
                body: "CUERPO",
                seamTag: "MARGEN",
                preparedBy: "Desarrollado por Aysun",
                description: "Herramienta profesional de expansiÃ³n"
            }
        };

        function App() {
            const [lang, setLang] = useState('tr'); 
            const [dB, setDB] = useState(200);   
            const [dT, setDT] = useState(80);    
            const [h, setH] = useState(150);     
            const [allowance, setAllowance] = useState(10);
            const [svgSize, setSvgSize] = useState(350);

            const t = translations[lang];

            useEffect(() => {
                const updateSize = () => {
                    const width = window.innerWidth;
                    setSvgSize(width < 500 ? width - 40 : 500);
                };
                updateSize();
                window.addEventListener('resize', updateSize);
                return () => window.removeEventListener('resize', updateSize);
            }, []);

            const compute = () => {
                const rB = Math.max(dB / 2.0, 0.1);
                const rT = Math.max(dT / 2.0, 0.1);
                const s = Math.hypot(h, rB - rT);
                const diff = rB - rT;
                const rOuter = Math.abs(diff) < 0.001 ? 999999 : (s * rB) / diff;
                const rInner = rOuter - s;
                const angleDeg = (360.0 * rB) / rOuter;
                return { rOuter, rInner, angleDeg, s };
            };

            const vals = compute();
            const margin = 40;
            const totalEffWidth = vals.rOuter + (allowance || 0);
            const scale = (totalEffWidth > 0) ? (svgSize / 2 - margin) / totalEffWidth : 1;
            const cx = svgSize / 2;
            const cy = svgSize / 2;

            const getPathData = (isDownload = false) => {
                const { rOuter, rInner, angleDeg } = vals;
                const sF = isDownload ? 1 : scale;
                const center = isDownload ? 500 : cx;
                const angleRad = (angleDeg * Math.PI) / 180.0;
                const largeArc = angleDeg > 180 ? 1 : 0;
                const allow = parseFloat(allowance) || 0;

                const pt = (r, a) => ({
                    x: center + r * Math.cos(a) * sF,
                    y: center + r * Math.sin(a) * sF
                });

                const p1o = pt(rOuter, 0);
                const p2o = pt(rOuter, angleRad);
                const p2i = pt(rInner, angleRad);
                const p1i = pt(rInner, 0);

                const main = `M ${p1o.x} ${p1o.y} A ${rOuter*sF} ${rOuter*sF} 0 ${largeArc} 1 ${p2o.x} ${p2o.y} L ${p2i.x} ${p2i.y} A ${rInner*sF} ${rInner*sF} 0 ${largeArc} 0 ${p1i.x} ${p1i.y} Z`;
                
                let seam = "";
                if (allow > 0) {
                    const p1o_ext = { x: p1o.x, y: p1o.y - (allow * sF) };
                    const p1i_ext = { x: p1i.x, y: p1i.y - (allow * sF) };
                    seam = `M ${p1o.x} ${p1o.y} L ${p1o_ext.x} ${p1o_ext.y} L ${p1i_ext.x} ${p1i_ext.y} L ${p1i.x} ${p1i.y} Z`;
                }
                return { main, seam };
            };

            const downloadSVG = () => {
                const paths = getPathData(true);
                const svgStr = `
                    <svg width="1000" height="1000" viewBox="0 0 1000 1000" xmlns="http://www.w3.org/2000/svg">
                        <rect width="1000" height="1000" fill="white" />
                        <path d="${paths.main}" fill="none" stroke="#4f46e5" stroke-width="0.5" />
                        ${paths.seam ? `<path d="${paths.seam}" fill="none" stroke="#dc2626" stroke-width="0.5" />` : ''}
                        <text x="20" y="940" font-family="Arial" font-size="14" font-weight="bold" fill="#4f46e5">${t.title}</text>
                        <text x="20" y="960" font-family="Arial" font-size="10" fill="#666">${t.preparedBy}</text>
                        <text x="20" y="980" font-family="Arial" font-size="9" fill="#999">dB:${dB} dT:${dT} h:${h} | Seam:${allowance}mm</text>
                    </svg>`;
                const blob = new Blob([svgStr], { type: 'image/svg+xml' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `lampshade-${lang}.svg`;
                link.click();
            };

            const downloadDXF = () => {
                const { rOuter, rInner, angleDeg } = vals;
                const angleRad = (angleDeg * Math.PI) / 180.0;
                const allow = parseFloat(allowance) || 0;
                
                let dxf = `0\nSECTION\n2\nENTITIES\n`;
                dxf += `0\nARC\n8\nLampshade_Body\n10\n0.0\n20\n0.0\n40\n${rOuter}\n50\n0.0\n51\n${angleDeg}\n`;
                dxf += `0\nARC\n8\nLampshade_Body\n10\n0.0\n20\n0.0\n40\n${rInner}\n50\n0.0\n51\n${angleDeg}\n`;
                dxf += `0\nLINE\n8\nLampshade_Body\n10\n${rInner}\n20\n0.0\n11\n${rOuter}\n21\n0.0\n`;
                dxf += `0\nLINE\n8\nLampshade_Body\n10\n${rInner * Math.cos(angleRad)}\n20\n${rInner * Math.sin(angleRad)}\n11\n${rOuter * Math.cos(angleRad)}\n21\n${rOuter * Math.sin(angleRad)}\n`;
                
                if (allow > 0) {
                    dxf += `0\nLINE\n8\nSeam_Allowance\n10\n${rOuter}\n20\n0.0\n11\n${rOuter}\n21\n-${allow}\n`;
                    dxf += `0\nLINE\n8\nSeam_Allowance\n10\n${rOuter}\n21\n-${allow}\n11\n${rInner}\n21\n-${allow}\n`;
                    dxf += `0\nLINE\n8\nSeam_Allowance\n10\n${rInner}\n21\n-${allow}\n11\n${rInner}\n21\n0.0\n`;
                }
                // Signature in DXF
                dxf += `0\nTEXT\n8\nCredits\n10\n20\n20\n-40\n40\n5.0\n1\n${t.preparedBy.toUpperCase()}\n`;

                dxf += `0\nENDSEC\n0\nEOF`;
                const blob = new Blob([dxf], { type: 'application/dxf' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `lampshade-pattern.dxf`;
                link.click();
            };

            const currentPaths = getPathData(false);

            return (
                <div className="flex flex-col min-h-screen">
                    <main className="p-4 md:p-8 max-w-6xl mx-auto flex-grow w-full">
                        <header className="mb-6 flex flex-col md:flex-row md:items-center justify-between gap-4">
                            <div className="text-center md:text-left">
                                <h1 className="text-2xl md:text-3xl font-black text-indigo-900 tracking-tighter">ðŸª„ {t.title}</h1>
                                <p className="text-[10px] text-indigo-500 font-bold uppercase tracking-[0.2em] opacity-80">{t.subtitle}</p>
                            </div>
                            
                            <div className="flex justify-center gap-1 bg-white p-1 rounded-xl border border-indigo-100 shadow-sm self-center">
                                {['en', 'tr', 'es'].map(l => (
                                    <button key={l} onClick={() => setLang(l)} className={`px-4 py-1.5 rounded-lg text-[10px] font-black transition-all ${lang === l ? 'bg-indigo-600 text-white shadow-md' : 'text-indigo-400 hover:bg-indigo-50'}`}>{l.toUpperCase()}</button>
                                ))}
                            </div>
                        </header>
                        
                        <div className="grid lg:grid-cols-3 gap-6">
                            <div className="bg-white p-6 rounded-3xl border border-indigo-50 shadow-2xl shadow-indigo-500/5 space-y-6 order-2 lg:order-1">
                                <div className="space-y-4">
                                    {[
                                        {label: t.bottomD, val: dB, set: setDB},
                                        {label: t.topD, val: dT, set: setDT},
                                        {label: t.height, val: h, set: setH},
                                        {label: t.seam, val: allowance, set: setAllowance}
                                    ].map((item, i) => (
                                        <div key={i}>
                                            <label className="text-[9px] font-black text-slate-400 uppercase tracking-[0.15em] mb-1.5 block">{item.label}</label>
                                            <input type="number" inputMode="decimal" value={item.val} 
                                                   onChange={e => item.set(Math.max(0, Number(e.target.value)))} 
                                                   className="block w-full border border-slate-100 rounded-2xl p-4 bg-slate-50/50 focus:bg-white focus:ring-8 focus:ring-indigo-500/5 focus:border-indigo-400 outline-none transition-all font-bold text-slate-700 text-sm" />
                                        </div>
                                    ))}
                                </div>

                                <div className="flex flex-col gap-3 pt-2">
                                    <button onClick={downloadSVG} className="w-full bg-indigo-600 text-white font-black py-4 rounded-2xl hover:bg-indigo-700 transition shadow-lg shadow-indigo-200 active:scale-[0.98] text-[10px] uppercase tracking-widest">{t.exportSvg}</button>
                                    <button onClick={downloadDXF} className="w-full bg-slate-900 text-white font-black py-4 rounded-2xl hover:bg-black transition shadow-lg active:scale-[0.98] text-[10px] uppercase tracking-widest">{t.exportDxf}</button>
                                </div>

                                <div className="space-y-3 pt-2">
                                    <h3 className="text-[9px] font-black text-indigo-300 uppercase tracking-widest text-center">{t.results}</h3>
                                    <div className="grid grid-cols-2 gap-3">
                                        <div className="bg-indigo-50/30 p-4 rounded-2xl border border-indigo-100/50 text-center">
                                            <span className="text-[8px] text-indigo-400 font-black uppercase block mb-1">{t.slant}</span>
                                            <span className="font-black text-indigo-900 text-lg">{vals.s.toFixed(1)}<small className="text-[10px] ml-0.5">mm</small></span>
                                        </div>
                                        <div className="bg-indigo-50/30 p-4 rounded-2xl border border-indigo-100/50 text-center">
                                            <span className="text-[8px] text-indigo-400 font-black uppercase block mb-1">{t.angle}</span>
                                            <span className="font-black text-indigo-900 text-lg">{vals.angleDeg.toFixed(1)}Â°</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div className="lg:col-span-2 bg-white rounded-3xl border border-indigo-50 flex flex-col items-center justify-center p-8 min-h-[400px] order-1 lg:order-2 overflow-hidden shadow-sm relative">
                                <div className="absolute top-6 right-6 flex gap-4 text-[9px] font-black tracking-widest">
                                    <span className="flex items-center gap-2 text-indigo-600 underline decoration-indigo-200 underline-offset-4">{t.body}</span>
                                    <span className="flex items-center gap-2 text-rose-600 underline decoration-rose-200 underline-offset-4">{t.seamTag}</span>
                                </div>
                                
                                <svg width={svgSize} height={svgSize} className="drop-shadow-2xl transition-all duration-700 ease-in-out">
                                    <path d={currentPaths.main} fill="rgba(79, 70, 229, 0.02)" stroke="#4f46e5" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" />
                                    {currentPaths.seam && <path d={currentPaths.seam} fill="rgba(225, 29, 72, 0.02)" stroke="#e11d48" strokeWidth="2" strokeDasharray="6 4" strokeLinecap="round" />}
                                    <circle cx={cx} cy={cy} r="3" fill="#e2e8f0" />
                                </svg>
                                
                                <p className="absolute bottom-6 text-[9px] text-slate-300 font-bold uppercase tracking-widest">{t.preview}</p>
                            </div>
                        </div>
                    </main>

                    {/* PROFESYONEL Ä°MZA BÃ–LÃœMÃœ (FOOTER) */}
                    <footer className="w-full bg-white border-t border-slate-100 pt-10 pb-12">
                        <div className="max-w-6xl mx-auto px-6 flex flex-col items-center">
                            <div className="w-full h-px signature-line mb-8"></div>
                            <div className="flex flex-col md:flex-row justify-between w-full items-center gap-6">
                                <div className="text-center md:text-left">
                                    <span className="text-indigo-900 font-black text-sm tracking-tighter">ðŸª„ {t.title}</span>
                                    <p className="text-[10px] text-slate-400 font-medium mt-1 uppercase tracking-wider">{t.description}</p>
                                </div>
                                
                                <div className="flex flex-col items-center md:items-end">
                                    <span className="text-[10px] text-slate-400 font-bold uppercase tracking-[0.2em] mb-1 opacity-60">Design & Code</span>
                                    <span className="text-indigo-600 font-black text-xs uppercase tracking-[0.3em] bg-indigo-50 px-4 py-2 rounded-full border border-indigo-100 shadow-sm">
                                        {t.preparedBy}
                                    </span>
                                </div>
                            </div>
                            <div className="mt-8 text-[9px] text-slate-300 font-medium uppercase tracking-widest">
                                Â© 2026 â€¢ Made with magic for creators
                            </div>
                        </div>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
